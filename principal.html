<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Performance Report</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    .report-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .page {
      background: white;
      padding: 48px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      page-break-after: always;
    }

    /* Header Styles */
    .page-header {
      border-bottom: 3px solid #2563eb;
      padding-bottom: 24px;
      margin-bottom: 32px;
    }

    .report-title {
      font-size: 32px;
      font-weight: 700;
      color: #1e293b;
      margin: 0 0 16px 0;
    }

    .school-info {
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      color: #64748b;
    }

    .info-label {
      font-weight: 600;
      color: #475569;
    }

    /* Layout for Split Section (Participation + Metrics) */
    .dashboard-split {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      margin-bottom: 40px;
    }

    @media (min-width: 1024px) {
      .dashboard-split {
        grid-template-columns: 2fr 1fr; /* 2/3 for Table, 1/3 for Metrics */
      }
    }

    /* Metrics Cards */
    .metrics-section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin: 0 0 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Vertical Metrics Stack */
    .vertical-metrics {
      display: flex;
      flex-direction: column;
      gap: 16px; /* Reduced gap slightly for tighter fit */
      height: 100%;
    }

    .vertical-metrics .metric-card {
      flex: 1; /* Distribute height equally */
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .metric-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 24px;
      border-radius: 12px;
      border-left: 4px solid #2563eb;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .metric-label {
      font-size: 14px;
      color: #64748b;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .metric-value {
      font-size: 36px;
      font-weight: 700;
      color: #1e293b;
    }

    /* Charts */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    /* NEW: stack charts vertically inside each column */
    .chart-column-stack {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .chart-container {
      background: #ffffff;
      padding: 24px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .chart-title {
      font-size: 16px;
      font-weight: 600;
      color: #475569;
      margin-bottom: 16px;
    }

    /* Vertical Bar Chart Styles for 10 Columns */
    .vertical-chart {
      min-height: 380px;
    }

    .vertical-bar-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-between; /* Spread columns out */
      height: 330px;
      padding: 70px 5px 60px 5px;
      background: linear-gradient(to top, #f8f9fa 0%, #f8f9fa 20%, transparent 20%, transparent 40%, #f8f9fa 40%, #f8f9fa 60%, transparent 60%, transparent 80%, #f8f9fa 80%, #f8f9fa 100%);
      border-radius: 8px;
      position: relative;
    }

    .bar-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1; /* Equal space distribution */
      min-width: 60px; /* Increased from 25px for wider stance */
      position: relative;
    }

    .bar-value-label {
      font-size: 14px; /* Reduced for better fit */
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
      min-height: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .bar-percentage {
      font-size: 14px; /* Reduced */
      font-weight: 700;
      color: #14b8a6;
    }

    .bar-count {
      font-size: 10px; /* Reduced */
      font-weight: 600;
      color: #64748b;
    }

    .vertical-bar-wrapper {
      width: 45px; /* Increased from 18px for wider bars */
      height: 200px;
      display: flex;
      align-items: flex-end;
      position: relative;
    }

    .vertical-bar {
      width: 100%;
      background: linear-gradient(180deg, #14b8a6 0%, #0d9488 100%);
      border-radius: 8px 8px 0 0;
      transition: all 0.4s ease;
      box-shadow: 0 2px 4px rgba(20, 184, 166, 0.3);
    }
    /* Specific color for Math */
    .math-bar {
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    }
    /* Specific color for Science */
    .science-bar {
      background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
      box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
    }

    .vertical-bar:hover {
      background: linear-gradient(180deg, #0d9488 0%, #0f766e 100%);
      transform: translateY(-4px);
      box-shadow: 0 4px 8px rgba(20, 184, 166, 0.4);
    }

    .bar-category-label {
      font-size: 11px; /* Slightly larger font */
      font-weight: 600;
      color: #64748b;
      text-align: center;
      margin-top: 8px;
      line-height: 1.2;
      position: absolute;
      bottom: -40px; /* Adjusted position */
      width: 100%; /* Reset width constraints */
      left: 0;
      white-space: normal; /* Allow wrapping */
      word-break: break-word;
    }

    /* Highlights Section */
    .highlights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .highlight-box {
      padding: 24px;
      border-radius: 12px;
      border: 2px solid;
    }

    .highlight-box.strengths {
      background: #f0fdf4;
      border-color: #10b981;
    }

    .highlight-box.remediation {
      background: #fef2f2;
      border-color: #ef4444;
    }

    .highlight-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .highlight-title.strengths { color: #059669; }
    .highlight-title.remediation { color: #dc2626; }

    .highlight-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .highlight-list li {
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .highlight-list.strengths li {
      background: white;
      color: #065f46;
      border-left: 3px solid #10b981;
    }

    .highlight-list.remediation li {
      background: white;
      color: #991b1b;
      border-left: 3px solid #ef4444;
    }

    /* Page 2 Styles */
    .excel-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-bottom: 32px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow-x: auto;
      display: block;
    }
    
    @media (min-width: 768px) {
        .excel-table { display: table; }
    }

    .excel-table th {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      padding: 16px 12px;
      text-align: center;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: none;
      position: relative;
    }

    .excel-table th:first-child {
      border-top-left-radius: 12px;
    }

    .excel-table th:last-child {
      border-top-right-radius: 12px;
    }

    .excel-table td {
      padding: 14px 12px;
      border: none;
      font-size: 15px;
      font-weight: 500;
      text-align: center;
      background: white;
      color: #1e293b;
      border-bottom: 1px solid #e5e7eb;
    }

    .excel-table td:first-child {
      font-weight: 700;
      text-align: left;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: #1e40af;
      font-size: 16px;
      padding-left: 20px;
    }

    .excel-table tbody tr {
      transition: all 0.3s ease;
    }

    .excel-table tbody tr:hover {
      background: #f0f9ff;
      transform: scale(1.01);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
    }

    .excel-table tbody tr:last-child td {
      border-bottom: none;
    }

    .excel-table tbody tr:last-child td:first-child {
      border-bottom-left-radius: 12px;
    }

    .excel-table tbody tr:last-child td:last-child {
      border-bottom-right-radius: 12px;
    }

    /* Segmentation Cards */
    .segmentation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .segment-card {
      padding: 24px;
      border-radius: 12px;
      border: 2px solid;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .segment-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .segment-card.high {
      background: #d1fae5;
      border-color: #10b981;
    }

    .segment-card.track {
      background: #fef3c7;
      border-color: #f59e0b;
    }

    .segment-card.support {
      background: #fee2e2;
      border-color: #ef4444;
    }

    .segment-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .segment-label {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .segment-card.high .segment-label { color: #065f46; }
    .segment-card.track .segment-label { color: #92400e; }
    .segment-card.support .segment-label { color: #991b1b; }

    /* New Criteria Style */
    .segment-criteria {
      font-size: 14px;
      font-style: italic;
      margin-bottom: 12px;
      font-weight: 600;
    }
    .segment-card.high .segment-criteria { color: #047857; }
    .segment-card.track .segment-criteria { color: #b45309; }
    .segment-card.support .segment-criteria { color: #b91c1c; }

    .segment-description {
      font-size: 15px;
      line-height: 1.5;
    }

    /* === INCREASED FONT SIZE FOR PERCENTAGES === */
    .segment-description strong {
      font-size: 32px;
      font-weight: 800;
      display: block;
      margin: 8px 0;
    }

    .segment-card.high .segment-description { color: #047857; }
    .segment-card.track .segment-description { color: #b45309; }
    .segment-card.support .segment-description { color: #b91c1c; }

    .segment-note {
      margin-top: 8px;
      font-size: 13px;
      font-style: italic;
      opacity: 0.8;
    }

    /* Teacher Dashboard Rows */
    .teacher-dashboard-section {
        margin-bottom: 48px;
    }

    .subject-row-container {
        margin-bottom: 40px;
        position: relative;
    }

    .subject-heading {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 16px;
        padding-left: 12px;
        border-left: 5px solid;
    }
    
    .subject-heading.english { border-left-color: #8b5cf6; } /* Violet for English */
    .subject-heading.math { border-left-color: #3b82f6; } /* Blue for Math */
    .subject-heading.science { border-left-color: #f59e0b; } /* Amber for Science */

    .teacher-scroll-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr); /* 5 columns strictly */
        gap: 12px;
        width: 100%;
        /* Removed overflow-x: auto to disable scroll */
    }

    .teacher-card {
        background: white;
        padding: 12px; /* Reduced padding */
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        min-width: 0; /* Allow shrinking */
        display: flex;
        flex-direction: column;
    }

    .teacher-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e2e8f0;
    }

    .grade-label {
      font-size: 14px; /* Reduced */
      font-weight: 700;
      color: #1e293b;
    }

    .focus-badge {
      background: #dbeafe;
      color: #1e40af;
      padding: 2px 6px; /* Reduced */
      border-radius: 8px;
      font-size: 10px; /* Reduced */
      font-weight: 600;
      text-transform: uppercase;
    }

    .focus-areas {
      margin-bottom: 8px;
      flex-grow: 1;
    }

    .focus-title {
      font-size: 11px; /* Reduced */
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .focus-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .focus-list li {
      padding: 2px 0; /* Reduced */
      font-size: 11px; /* Reduced */
      color: #475569;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .focus-list li:before {
      content: "‚Ä¢";
      color: #3b82f6;
      font-weight: 700;
    }

    .reflection-prompt {
      background: #f8fafc;
      padding: 8px; /* Reduced */
      border-radius: 6px;
      font-size: 10px; /* Reduced */
      color: #475569;
      font-style: italic;
      border-left: 3px solid #3b82f6;
      margin-top: 8px;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal-overlay.active {
      display: flex;
      opacity: 1;
    }
    .modal-content {
      background: white;
      padding: 32px;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }
    .modal-header {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #1e293b;
    }
    .modal-body {
      font-size: 16px;
      color: #475569;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .modal-close {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      float: right;
    }
    .modal-close:hover {
      background: #1d4ed8;
    }

    /* Print & Share Buttons */
    .action-buttons {
        position: fixed;
        bottom: 30px;
        right: 30px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 100;
    }

    .btn-fab {
        background: #2563eb;
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
        cursor: pointer;
        border: none;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
    }

    .btn-fab:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
        background: #1d4ed8;
    }
    
    .btn-secondary {
        background: white;
        color: #2563eb;
        border: 2px solid #2563eb;
    }
    .btn-secondary:hover {
        background: #f0f9ff;
    }

    /* Print Styles */
    @media print {
      body {
        background: white;
      }
      .report-container {
        padding: 0;
      }
      .page {
        box-shadow: none;
        page-break-after: always;
        margin-bottom: 0;
      }
      .modal-overlay, .action-buttons {
        display: none !important;
      }
      .teacher-scroll-row {
          display: grid;
          grid-template-columns: repeat(5, 1fr);
          gap: 10px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  
  <div class="action-buttons">
      <button class="btn-fab btn-secondary" onclick="copyLink()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
        Copy Link
      </button>
      <button class="btn-fab btn-secondary" onclick="downloadReport()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        Download HTML
      </button>
      <button class="btn-fab" onclick="window.print()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
        Print / PDF
      </button>
  </div>

  <div class="report-container">
   <!-- PAGE 1: SCHOOL OVERVIEW -->
   <div class="page" id="page1">
    <div class="page-header">
     <h1 class="report-title" id="reportTitle">School Performance Report for Principals</h1>
     <div class="school-info">
      <div class="info-item"><span class="info-label">üè´ School:</span> <span id="schoolName">Oakwood Elementary</span></div>
      <div class="info-item"><span class="info-label">üìö Grades:</span> <span id="gradeCoverage">Grades 1-5</span></div>
      <div class="info-item"><span class="info-label">üë• Total Registered:</span> <span id="total Students">2000</span></div>
      <div class="info-item"><span class="info-label">üë• Total Participated:</span> <span>500</span></div>
     </div>
    </div>

    <!-- NEW LAYOUT: Participation & Metrics Side-by-Side -->
    <div class="dashboard-split">
      <div class="participation-column">
        <h2 class="section-title">üìã Participation Overview</h2>
        <div class="chart-container" style="padding: 0; overflow: hidden; height: 100%;">
          <div class="overflow-x-auto h-full">
            <table class="w-full h-full text-sm text-left border-collapse">
              <thead>
                <tr class="bg-slate-50 border-b border-slate-200 text-slate-500 uppercase text-xs">
                  <th class="py-4 px-6 font-bold text-left">Grade</th>
                  <th class="py-4 px-6 font-bold text-center">üë• Registered</th>
                  <th class="py-4 px-6 font-bold text-center">üìù Participated</th>
                  <th class="py-4 px-6 font-bold text-center">Participation %</th>
                </tr>
              </thead>
              <tbody class="text-slate-600 bg-white">
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-4 px-6 font-bold text-slate-700">Grade 1</td>
                  <td class="py-4 px-6 text-center font-medium">380</td>
                  <td class="py-4 px-6 text-center font-bold text-blue-600">95</td>
                  <td class="py-4 px-6 text-center font-bold text-slate-700">25%</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-4 px-6 font-bold text-slate-700">Grade 2</td>
                  <td class="py-4 px-6 text-center font-medium">410</td>
                  <td class="py-4 px-6 text-center font-bold text-blue-600">82</td>
                  <td class="py-4 px-6 text-center font-bold text-slate-700">20%</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-4 px-6 font-bold text-slate-700">Grade 3</td>
                  <td class="py-4 px-6 text-center font-medium">390</td>
                  <td class="py-4 px-6 text-center font-bold text-blue-600">105</td>
                  <td class="py-4 px-6 text-center font-bold text-slate-700">27%</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-4 px-6 font-bold text-slate-700">Grade 4</td>
                  <td class="py-4 px-6 text-center font-medium">420</td>
                  <td class="py-4 px-6 text-center font-bold text-blue-600">88</td>
                  <td class="py-4 px-6 text-center font-bold text-slate-700">21%</td>
                </tr>
                <tr class="hover:bg-slate-50 transition-colors">
                  <td class="py-4 px-6 font-bold text-slate-700">Grade 5</td>
                  <td class="py-4 px-6 text-center font-medium">400</td>
                  <td class="py-4 px-6 text-center font-bold text-blue-600">80</td>
                  <td class="py-4 px-6 text-center font-bold text-slate-700">20%</td>
                </tr>
                <tr class="bg-slate-50 border-t border-slate-200">
                  <td class="py-4 px-6 font-black text-slate-800 uppercase text-xs tracking-wider">Total</td>
                  <td class="py-4 px-6 text-center font-black text-slate-800">2000</td>
                  <td class="py-4 px-6 text-center font-black text-blue-700">450</td>
                  <td class="py-4 px-6 text-center font-black text-slate-800">22.5%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="metrics-column">
        <h2 class="section-title">üìä Performance Overview</h2>
        <div class="vertical-metrics">
          <div class="metric-card">
            <div class="metric-label">Math Average</div>
            <div class="metric-value">72%</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">English Average</div>
            <div class="metric-value">68%</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Science Average</div>
            <div class="metric-value">75%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Student distribution -->
    <div class="metrics-section" style="margin-top: 60px;">
     <h2 class="section-title">üéØ Student distribution</h2>
     <div class="segmentation-grid">
      <div class="segment-card high" onclick="showSegmentDetails('high')">
       <div class="segment-icon">üåü</div>
       <div class="segment-label">High Performers</div>
       <div class="segment-criteria">(At grade Level)</div>
       <div class="segment-description"><strong>35% of students</strong><br></div>
       <div class="segment-note">Provide enrichment activities</div>
      </div>
      <div class="segment-card track" onclick="showSegmentDetails('track')">
       <div class="segment-icon">üìä</div>
       <div class="segment-label">On Track</div>
       <div class="segment-criteria">(1-2 years below)</div>
       <div class="segment-description"><strong>40% of students</strong><br></div>
       <div class="segment-note">Maintain current support</div>
      </div>
      <div class="segment-card support" onclick="showSegmentDetails('support')">
       <div class="segment-icon">üÜò</div>
       <div class="segment-label">Needs Support</div>
       <div class="segment-criteria">(3-4 years below)</div>
       <div class="segment-description"><strong>25% of students</strong><br></div>
       <div class="segment-note">Requires targeted intervention</div>
      </div>
     </div>
     <p style="text-align: center; color: #64748b; font-size: 35px; font-style: italic; margin-top: 16px;">
      <b> Subject wise - Gap to Grade Level </b>
     </p>
    </div>

    <!-- Graphs / Charts -->
    <div class="metrics-section">
     <div class="charts-grid">
      <div class="chart-column-stack">
       <div class="chart-container vertical-chart">
        <div class="chart-title">English ‚Äì Gap to Grade Level</div>
        <div class="vertical-bar-chart">
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage">55%</span><span class="bar-count">(1100)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar" style="height: 100%"></div></div>
          <div class="bar-category-label">At Grade Level</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage">15%</span><span class="bar-count">(300)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar" style="height: 27.3%"></div></div>
          <div class="bar-category-label">1 Year Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage">10%</span><span class="bar-count">(200)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar" style="height: 18.2%"></div></div>
          <div class="bar-category-label">2 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage">6%</span><span class="bar-count">(120)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar" style="height: 10.9%"></div></div>
          <div class="bar-category-label">3 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage">4%</span><span class="bar-count">(80)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar" style="height: 7.3%"></div></div>
          <div class="bar-category-label">4 Years Below</div>
         </div>
        </div>
       </div>

       <div class="chart-container vertical-chart">
        <div class="chart-title">Science ‚Äì Gap to Grade Level</div>
        <div class="vertical-bar-chart">
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-yellow-600">70%</span><span class="bar-count">(1400)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar science-bar" style="height: 100%"></div></div>
          <div class="bar-category-label">At Grade Level</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-yellow-600">10%</span><span class="bar-count">(200)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar science-bar" style="height: 14.3%"></div></div>
          <div class="bar-category-label">1 Year Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-yellow-600">8%</span><span class="bar-count">(160)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar science-bar" style="height: 11.4%"></div></div>
          <div class="bar-category-label">2 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-yellow-600">5%</span><span class="bar-count">(100)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar science-bar" style="height: 7.1%"></div></div>
          <div class="bar-category-label">3 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-yellow-600">3%</span><span class="bar-count">(60)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar science-bar" style="height: 4.3%"></div></div>
          <div class="bar-category-label">4 Years Below</div>
         </div>
        </div>
       </div>
      </div>

      <div class="chart-column-stack">
       <div class="chart-container vertical-chart">
        <div class="chart-title">Math ‚Äì Gap to Grade Level</div>
        <div class="vertical-bar-chart">
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-blue-600">65%</span><span class="bar-count">(1300)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar math-bar" style="height: 100%"></div></div>
          <div class="bar-category-label">At Grade Level</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-blue-600">12%</span><span class="bar-count">(240)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar math-bar" style="height: 18.5%"></div></div>
          <div class="bar-category-label">1 Year Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-blue-600">10%</span><span class="bar-count">(200)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar math-bar" style="height: 15.4%"></div></div>
          <div class="bar-category-label">2 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-blue-600">5%</span><span class="bar-count">(100)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar math-bar" style="height: 7.7%"></div></div>
          <div class="bar-category-label">3 Years Below</div>
         </div>
         <div class="bar-column">
          <div class="bar-value-label"><span class="bar-percentage text-blue-600">3%</span><span class="bar-count">(60)</span></div>
          <div class="vertical-bar-wrapper"><div class="vertical-bar math-bar" style="height: 4.6%"></div></div>
          <div class="bar-category-label">4 Years Below</div>
         </div>
        </div>
       </div>

       <div class="chart-container vertical-chart">
        <div class="chart-title">‚úÖ Level Distribution Logic</div>
        <div style="padding: 20px; height: 330px; display: flex; flex-direction: column; justify-content: space-between;">
          <div>
            <p class="text-slate-500 text-sm mb-4 leading-relaxed">
              Checks how high the student answers questions from <strong>lower grades</strong>.
            </p>
            <div class="mb-4 bg-blue-50 p-3 rounded-lg border border-blue-100">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-blue-600 text-base">üìò</span>
                <span class="font-bold uppercase tracking-wide text-xs text-blue-800">RULE</span>
              </div>
              <p class="text-sm text-slate-700 italic leading-snug">
                Performance level = <span class="text-blue-700 font-semibold">highest grade-level questions passed</span>.
              </p>
            </div>
            <p class="text-sm mb-3 text-slate-600 font-medium">Example: <strong>5th-grade student</strong></p>
          </div>
          <div class="w-full">
            <table class="w-full text-xs text-left border-collapse">
              <thead>
                <tr class="bg-slate-50 border-b border-slate-200 text-slate-500 uppercase text-[10px]">
                  <th class="py-1.5 px-1.5 font-bold text-left">Questions</th>
                  <th class="py-1.5 px-1.5 font-bold text-center">Level</th>
                  <th class="py-1.5 px-1.5 font-bold text-left">Meaning</th>
                </tr>
              </thead>
              <tbody class="text-slate-600">
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-1 px-1.5 font-medium">Grade 4</td>
                  <td class="py-1 px-1.5 text-center font-bold text-emerald-600">L5</td>
                  <td class="py-1 px-1.5 text-emerald-700 text-xs">At Level</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-1 px-1.5">Grade 3</td>
                  <td class="py-1 px-1.5 text-center font-bold text-slate-700">L4</td>
                  <td class="py-1 px-1.5 text-amber-600 text-xs">1 Yr Below</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-1 px-1.5">Grade 2</td>
                  <td class="py-1 px-1.5 text-center font-bold text-slate-700">L3</td>
                  <td class="py-1 px-1.5 text-amber-600 text-xs">2 Yr Below</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-1 px-1.5">Grade 1</td>
                  <td class="py-1 px-1.5 text-center font-bold text-slate-700">L2</td>
                  <td class="py-1 px-1.5 text-orange-600 text-xs">3 Yr Below</td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                  <td class="py-1 px-1.5">Foundational</td>
                  <td class="py-1 px-1.5 text-center font-bold text-slate-700">L1</td>
                  <td class="py-1 px-1.5 text-red-600 text-xs">4 Yr Below</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
       </div>
      </div>
     </div>
    </div>

    <!-- Performance Highlights -->
    <div class="metrics-section">
     <h2 class="section-title">‚ú® Performance Highlights</h2>
     <div class="highlights-grid">
      <div class="highlight-box strengths">
       <div class="highlight-title strengths">‚úì Top 3 Strengths</div>
       <ul class="highlight-list strengths">
        <li>Number recognition and counting</li>
        <li>Oral vocabulary development</li>
        <li>Basic arithmetic operations</li>
       </ul>
      </div>
      <div class="highlight-box remediation">
       <div class="highlight-title remediation">‚ö† Top 3 Areas Needing Support</div>
       <ul class="highlight-list remediation">
        <li>Sentence reading fluency</li>
        <li>Division and fractions</li>
        <li>Multi-step word problems</li>
       </ul>
      </div>
     </div>
    </div>

    <!-- Grade Performance Tables (English, Maths, Science) -->
    <div class="metrics-section">
     <h2 class="section-title">üìä English ‚Äì Grade-wise Proficiency level table</h2>
     <div class="overflow-x-auto">
         <table class="excel-table">
         <thead>
          <tr>
           <th>Grade</th>
           <th>Level 0</th>
           <th>Level 1</th>
           <th>Level 2</th>
           <th>Level 3</th>
           <th>Level 4</th>
           <th>Level 5</th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>Grade 1</td>
           <td>29</td>
           <td>31</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 2</td>
           <td>23</td>
           <td>48</td>
           <td>12</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 3</td>
           <td>159</td>
           <td>70</td>
           <td>176</td>
           <td>96</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 4</td>
           <td>327</td>
           <td>-</td>
           <td>169</td>
           <td>10</td>
           <td>42</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 5</td>
           <td>233</td>
           <td>-</td>
           <td>146</td>
           <td>131</td>
           <td>70</td>
           <td>14</td>
          </tr>
         </tbody>
        </table>
     </div>
    </div>
   </div>

   <!-- PAGE 2: ACTIONABLE INSIGHTS -->
   <div class="page" id="page2">
    <div class="page-header">
     <h1 class="report-title"></h1>
    </div>

    <div class="metrics-section">
     <h2 class="section-title">üìä Maths ‚Äì Grade-wise Proficiency level Table </h2>
     <div class="overflow-x-auto">
         <table class="excel-table">
         <thead>
          <tr>
           <th>Grade</th>
           <th>Level 0</th>
           <th>Level 1</th>
           <th>Level 2</th>
           <th>Level 3</th>
           <th>Level 4</th>
           <th>Level 5</th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>Grade 1</td>
           <td>29</td>
           <td>31</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 2</td>
           <td>23</td>
           <td>48</td>
           <td>12</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 3</td>
           <td>159</td>
           <td>70</td>
           <td>176</td>
           <td>96</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 4</td>
           <td>327</td>
           <td>-</td>
           <td>169</td>
           <td>10</td>
           <td>42</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 5</td>
           <td>233</td>
           <td>-</td>
           <td>146</td>
           <td>131</td>
           <td>70</td>
           <td>14</td>
          </tr>
         </tbody>
        </table>
     </div>
    </div>
    
    <div class="metrics-section">
     <h2 class="section-title">üìä Science ‚Äì Grade-wise Proficiency level Table </h2>
     <div class="overflow-x-auto">
         <table class="excel-table">
         <thead>
          <tr>
           <th>Grade</th>
           <th>Level 0</th>
           <th>Level 1</th>
           <th>Level 2</th>
           <th>Level 3</th>
           <th>Level 4</th>
           <th>Level 5</th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>Grade 1</td>
           <td>29</td>
           <td>31</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 2</td>
           <td>23</td>
           <td>48</td>
           <td>12</td>
           <td>-</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 3</td>
           <td>159</td>
           <td>70</td>
           <td>176</td>
           <td>96</td>
           <td>-</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 4</td>
           <td>327</td>
           <td>-</td>
           <td>169</td>
           <td>10</td>
           <td>42</td>
           <td>-</td>
          </tr>
          <tr>
           <td>Grade 5</td>
           <td>233</td>
           <td>-</td>
           <td>146</td>
           <td>131</td>
           <td>70</td>
           <td>14</td>
          </tr>
         </tbody>
        </table>
     </div>
    </div>

    <!-- Teacher Dashboard Section -->
    <div class="metrics-section teacher-dashboard-section">
     <h2 class="section-title">üë©‚Äçüè´ Teacher Dashboard ‚Äì Focus Areas</h2>
     
     <!-- English Row -->
     <div class="subject-row-container">
         <div class="subject-heading english">English Focus Area</div>
         <div class="teacher-scroll-row">
             <!-- G1 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 1</div><div class="focus-badge">Foundation</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Phonics and letter sounds</li>
                 <li>Simple sentence structure</li>
                 <li>Sight word recognition</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How can we improve early reading fluency?"</div>
             </div>
             <!-- G2 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 2</div><div class="focus-badge">Building</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Reading comprehension basics</li>
                 <li>Expanding vocabulary</li>
                 <li>Writing simple paragraphs</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Are students connecting ideas in texts?"</div>
             </div>
             <!-- G3 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 3</div><div class="focus-badge">Critical</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Grammar and punctuation</li>
                 <li>Story sequencing</li>
                 <li>Inferencing skills</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Can students infer meaning from context?"</div>
             </div>
             <!-- G4 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 4</div><div class="focus-badge">Developing</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Essay structure introduction</li>
                 <li>Advanced vocabulary usage</li>
                 <li>Reading fluency in long texts</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How to encourage expressive writing?"</div>
             </div>
             <!-- G5 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 5</div><div class="focus-badge">Priority</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Persuasive writing techniques</li>
                 <li>Analyzing complex texts</li>
                 <li>Oral presentation skills</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Are they ready for middle school English?"</div>
             </div>
         </div>
     </div>

     <!-- Math Row -->
     <div class="subject-row-container">
         <div class="subject-heading math">Math Focus Area</div>
         <div class="teacher-scroll-row">
             <!-- G1 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 1</div><div class="focus-badge">Foundation</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Number sense (1-20)</li>
                 <li>Basic shapes and patterns</li>
                 <li>Simple addition and subtraction</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How can we strengthen foundational maths skills?"</div>
             </div>
             <!-- G2 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 2</div><div class="focus-badge">Building</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Place value understanding</li>
                 <li>Simple word problems</li>
                 <li>Two-digit addition with regrouping</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Are students mastering place value concepts?"</div>
             </div>
             <!-- G3 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 3</div><div class="focus-badge">Critical</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Multiplication tables (up to 10)</li>
                 <li>Multi-step word problems</li>
                 <li>Introduction to division concepts</li>
                </ul>
               </div>
               <div class="reflection-prompt">"What strategies boost multiplication fluency?"</div>
             </div>
             <!-- G4 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 4</div><div class="focus-badge">Developing</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Long division practice</li>
                 <li>Fraction concepts and equivalence</li>
                 <li>Multi-digit multiplication</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How can we build division confidence?"</div>
             </div>
             <!-- G5 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 5</div><div class="focus-badge">Priority</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Fractions and decimals operations</li>
                 <li>Algebraic thinking</li>
                 <li>Volume and measurement</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How can we bridge the Grade 5 maths gap?"</div>
             </div>
         </div>
     </div>

     <!-- Science Row -->
     <div class="subject-row-container">
         <div class="subject-heading science">Science Focus Area</div>
         <div class="teacher-scroll-row">
             <!-- G1 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 1</div><div class="focus-badge">Discovery</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Five senses exploration</li>
                 <li>Seasons and weather</li>
                 <li>Living vs. non-living things</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How to encourage observation skills?"</div>
             </div>
             <!-- G2 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 2</div><div class="focus-badge">Exploration</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Plant life cycles</li>
                 <li>Animal habitats</li>
                 <li>Properties of matter basics</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Are they asking 'why' questions?"</div>
             </div>
             <!-- G3 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 3</div><div class="focus-badge">Inquiry</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Forces and motion</li>
                 <li>Water cycle</li>
                 <li>Simple machines</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Can they predict outcomes of simple tests?"</div>
             </div>
             <!-- G4 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 4</div><div class="focus-badge">Analysis</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Energy forms (light, sound)</li>
                 <li>Ecosystems and food chains</li>
                 <li>Earth's surface changes</li>
                </ul>
               </div>
               <div class="reflection-prompt">"How well do they understand cause and effect?"</div>
             </div>
             <!-- G5 -->
             <div class="teacher-card">
               <div class="teacher-card-header"><div class="grade-label">Grade 5</div><div class="focus-badge">Synthesis</div></div>
               <div class="focus-areas">
                <div class="focus-title">Remediation Focus</div>
                <ul class="focus-list">
                 <li>Human body systems</li>
                 <li>Solar system structure</li>
                 <li>Matter and chemical changes</li>
                </ul>
               </div>
               <div class="reflection-prompt">"Are they connecting concepts across units?"</div>
             </div>
         </div>
     </div>

    </div>
   </div>
  </div>

  <!-- Custom Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-content">
      <div class="modal-header" id="modalHeader">Title</div>
      <div class="modal-body" id="modalBody">Message</div>
      <button class="modal-close" onclick="closeModal(event)">Close</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('School Performance Report Loaded');
      
      // Animate bars on load
      const bars = document.querySelectorAll('.vertical-bar');
      bars.forEach(bar => {
        const targetHeight = bar.style.height;
        bar.style.height = '0%';
        setTimeout(() => {
          bar.style.height = targetHeight;
        }, 300);
      });
    });

    function showSegmentDetails(segment) {
      const titles = {
        'high': 'üåü High Performers',
        'track': 'üìä On Track',
        'support': 'üÜò Needs Support'
      };
      
      const messages = {
        'high': '158 students identified. Recommended actions: Advanced placement consideration, Peer tutoring roles.',
        'track': '180 students identified. Recommended actions: Maintenance of current curriculum, Regular check-ins.',
        'support': '112 students identified. Recommended actions: Mandatory after-school tutoring, Individualized Education Plan review.'
      };

      const overlay = document.getElementById('modalOverlay');
      const header = document.getElementById('modalHeader');
      const body = document.getElementById('modalBody');

      if(overlay && header && body) {
        header.textContent = titles[segment] || 'Details';
        body.textContent = messages[segment] || 'Student details not available.';
        overlay.classList.add('active');
      }
    }

    function closeModal(event) {
      if (event.target.id === 'modalOverlay' || event.target.classList.contains('modal-close')) {
         const overlay = document.getElementById('modalOverlay');
         if (overlay) overlay.classList.remove('active');
      }
    }

    // --- Share Functions ---
    function copyLink() {
      // Tries to copy the current URL.
      // Note: In some iframe/sandbox environments, this might return the iframe source URL 
      // or permission might be denied.
      const url = window.location.href;
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url)
          .then(() => {
             // Use our custom modal for feedback instead of alert
             const overlay = document.getElementById('modalOverlay');
             const header = document.getElementById('modalHeader');
             const body = document.getElementById('modalBody');
             if(overlay && header && body) {
                header.textContent = 'Link Copied!';
                body.innerHTML = `The link to this report has been copied to your clipboard:<br><br><strong>${url}</strong>`;
                overlay.classList.add('active');
             }
          })
          .catch(err => {
             console.error('Failed to copy: ', err);
             fallbackCopy(url);
          });
      } else {
        fallbackCopy(url);
      }
    }

    function fallbackCopy(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        
        // Ensure textArea is not visible but part of DOM
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
             const overlay = document.getElementById('modalOverlay');
             const header = document.getElementById('modalHeader');
             const body = document.getElementById('modalBody');
             if(overlay && header && body) {
                header.textContent = 'Link Copied!';
                body.innerHTML = `The link to this report has been copied to your clipboard:<br><br><strong>${text}</strong>`;
                overlay.classList.add('active');
             }
        } catch (err) {
            console.error('Fallback: Oops, unable to copy', err);
            alert('Unable to copy link automatically. Please copy the URL from your browser address bar.');
        }
        
        document.body.removeChild(textArea);
    }

    function downloadReport() {
        // Gets the entire HTML content of the page
        const htmlContent = "<!doctype html>\n" + document.documentElement.outerHTML;
        
        // Create a blob
        const blob = new Blob([htmlContent], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        
        // Create a temporary link to trigger download
        const a = document.createElement('a');
        a.href = url;
        a.download = 'school_performance_report.html';
        document.body.appendChild(a);
        a.click();
        
        // Cleanup
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 0);
    }
  </script>
 </body>
</html>